<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="rmerp-data.html">

<link rel="import" href="rmerp-clients-list.html">

<dom-module id="rmerp-clients">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <rmerp-data data="{{data}}" url="/clients" loading="{{loading}}"></rmerp-data>

    <app-route
        route="{{route}}"
        pattern="/:client_id"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

    <iron-pages selected="[[page]]" attr-for-selected="name" fallback-selection="404" role="main">
      <rmerp-clients-list name="list" data="{{data}}" load-complete="[[loadComplete]]" small-screen="[[smallScreen]]" route="[[subroute]]" offline="[[offline]]"></rmerp-clients-list>
      <rmerp-clients-overview name="overview"></rmerp-clients-overview>
      <rmerp-clients-settings name="settings" small-screen="[[smallScreen]]" offline="[[offline]]"></rmerp-clients-settings>
      <rmerp-404-warning name="404"></rmerp-404-warning>
    </iron-pages>

  </template>

  <script>

    class RMERPClients extends Polymer.Element {

      static get is() { 
        return 'rmerp-clients'; 
      }

      static get properties() {
        return {

          id: {
            type: String,
            reflectToAttribute: true,
            observer: '_idChanged',
          },

          page: {
            type: String,
            reflectToAttribute: true,
            observer: '_pageChanged',
          }

        };
      }

      static get observers() {
        return [
          /*'_routeIdPageChanged(routeData.id, routeData.page)'*/
          '_routeIdChanged(routeData)'
        ];
      }

      /*_routeIdPageChanged(routeDataId, routeDataPage) {
        console.log("_routeIdPageChanged", this.routeData, routeDataId, routeDataPage);
        if (!routeDataId) {
          this.set('routeData.page', '');
          this.page = 'list';
          return;
        }

        if (routeDataId && !routeDataPage) {
          this.set('routeData.page', 'overview');
          return;
        }

        this.id = routeDataId || '';
        this.page = routeDataPage || 'overview';
      }*/

      _routeIdChanged(routeDataId) {
        console.log("_routeIdChanged", this.routeData, routeDataId);
        if (routeDataId === undefined) {
          return;
        }

        if (!routeDataId) {
          this.set('routeData.page', '');
          this.page = 'list';
          return;
        }

        if (routeDataId) {
          this.set('routeData.page', 'overview');
          return;
        }

        this.id = routeDataId || '';
        this.page = 'overview';
      }

      _idChanged(id) {
      }

      _pageChanged(page) {
        if (page != null) {
          var resolvedPageUrl = this.resolveUrl('rmerp-clients-' + page + '.html');
          if (page === '404-warning') {
            resolvedPageUrl = this.resolveUrl('rmerp-' + page + '.html');
          }
          // clients route is eagerly loaded
          if (page === 'list') {
          }
          else {
            // When a load failed, it triggered a 404 which means we need to
            // eagerly load the 404 page definition
            Polymer.importHref(resolvedPageUrl, null, null, true);
          }
        }
      }

    }

    window.customElements.define(RMERPClients.is, RMERPClients);

  </script>
</dom-module>

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymerfire/firebase.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<dom-module id="rmerp-data">

  <template>

    <firebase-app
      name="rmerp"
      auth-domain="rmerp-19591.firebaseapp.com"
      database-url="https://rmerp-19591.firebaseio.com"
      api-key="AIzaSyDgZxxPgit5IE1YPQwAKgF84ARH3egnoKg"></firebase-app>

    <firebase-document
      id="query"
      app-name="rmerp"
      path="/[[collection]]"
      data="{{itemsDataObject}}"></firebase-document>

    <firebase-document
      id="document"
      app-name="rmerp"
      path="/[[collection]]/[[itemId]]"
      data="{{itemDataObject}}"></firebase-document>

    <!--<firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError"></firebase-auth>-->

  </template>

  <script>

    class RMERPData extends Polymer.Element {

      static get is() { 
        return 'rmerp-data'; 
      }

      static get properties() {
        return {

          collection: String,

          itemsDataObject: Object,

          items: {
            type: Array,
            notify: true,
            computed: '_computeItems(itemsDataObject)'
          },

          itemId: String,

          itemDataObject: Object,

          item: {
            type: Object,
            notify: true,
            computed: '_computeItem(itemDataObject)'
          }

        }
      }

      _computeItems(itemsDataObject) {
        return Object.keys(itemsDataObject).map(function(key) {
          var object = itemsDataObject[key];
          object.id = key;
          return object;   
        });
      }

      _computeItem(itemDataObject) {
        console.log(itemDataObject, this.itemId);
        itemDataObject.id = this.itemId;
        return itemDataObject;
      }

    }

    window.customElements.define(RMERPData.is, RMERPData);

  </script>
</dom-module>



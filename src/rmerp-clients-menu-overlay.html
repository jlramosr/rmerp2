<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/overlay-container/overlay-mixin.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="rmerp-styles.html">

<dom-module id="rmerp-clients-menu-overlay">
  <template>

    <style include="content-styles form-styles">
      :host {
        position: absolute;
        background: #fff;
      }

    </style> 
     HOLAAAAAAAAAAAAA

  </template>

  <script>

    class RMERPClientsMenuOverlay extends OverlayMixin(Polymer.Element) {/*Polymer.mixinBehaviors([
      Polymer.IronResizableBehavior,
    ], Polymer.Element, OverlayMixin(Polymer.Element)) {*/

      static get is() { return 'rmerp-clients-menu-overlay'; }

      static get properties() {
        return {

          positionTarget: Object

        };
      }

      constructor() {
        super();
        this._overlayOpened = this._overlayOpened.bind(this);
        this._documentTapped = this._documentTapped.bind(this);
      }

      connectedCallback() {
        super.connectedCallback();
        this._toggleListeners({enable: true});
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        this._toggleListeners({enable: false});
      }

      _toggleListeners({enable}) {
        const m = enable ? 'addEventListener' : 'removeEventListener';
        this[m]('overlay-opened', this._overlayOpened);
        this[m]('iron-resize', this._positioningOverlay);
        document[m]('click', this._documentTapped);
      }

      _overlayOpened() {
        this._positioningOverlay();
      }

      _documentTapped() {
        this.opened = false;
      }

      _positioningOverlay() {
        const documentWidth = document.body.offsetWidth;

        const overlayWidth = this.getBoundingClientRect().width;
        const rect = this.positionTarget.getBoundingClientRect();
        const rightSpace = documentWidth - rect.left;

        console.log(rightSpace, overlayWidth);

        this.style.top = rect.bottom - 32 + 'px';
        if (rightSpace > overlayWidth) {
          this.style.left = rect.left + 'px';
        } else {
          this.style.left = rect.left + 32 - overlayWidth + 'px';
        }
        
      }

    }

    window.customElements.define(RMERPClientsMenuOverlay.is, RMERPClientsMenuOverlay);

  </script>
</dom-module>

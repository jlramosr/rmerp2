<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<dom-module id="rmerp-backend-data">

  <template>

    <firebase-document
      id="query"
      app-name="rmerp"
      path="/[[collection]]"
      data="{{itemsDataObject}}"></firebase-document>

    <firebase-document
      id="document"
      app-name="rmerp"
      path="/[[collection]]/[[itemId]]"
      data="{{itemDataObject}}"></firebase-document>

    <!--<firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError"></firebase-auth>-->

  </template>

  <script>

    class RMERPBackendData extends Polymer.Element {

      static get is() { return 'rmerp-backend-data'; }

      static get properties() {
        return {

          collection: String,

          itemsDataObject: Object,

          items: {
            type: Array,
            notify: true,
            computed: '_computeItems(itemsDataObject)',
            observer: '_itemsChanged',
          },

          itemId: String,

          itemDataObject: Object,

          item: {
            type: Object,
            notify: true,
            computed: '_computeItem(itemDataObject)',
            observer: '_itemChanged',
          },

          loading: {
            type: Boolean,
            notify: true,
            value: true
          }

        }
      }

      create(item) {
        console.log("CREATE ITEM BACKEND", item);
      }

      update(id) {
        console.log("UPDATE ITEM BACKEND", id);
      }

      delete(id) {
        console.log("DELETE ITEM BACKEND", id);
      }

      _computeItems(itemsDataObject) {
        return Object.keys(itemsDataObject).map(function(key) {
          var object = itemsDataObject[key];
          object.id = key;
          return object;   
        });
      }

      _computeItem(itemDataObject) {
        itemDataObject.id = this.itemId;
        return itemDataObject;
      }

      _itemsChanged(items, oldItems) {
        this.loading = true;
        if (oldItems) {
          this.loading = false;
        }
      }

      _itemChanged(item, oldItem) {
        this.loading = true;
        if (this.itemId && oldItem) {
          this.loading = false;
        }
      }

    }

    window.customElements.define(RMERPBackendData.is, RMERPBackendData);

  </script>
</dom-module>


